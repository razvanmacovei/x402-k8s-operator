apiVersion: x402.io/v1alpha1
kind: X402Route
metadata:
  name: my-api-conditional
  namespace: default
spec:
  ingressRef:
    name: my-api-ingress
    namespace: default
  payment:
    wallet: "0x1f6004907Adc7d313768b85917e069e011150390"
    network: base-sepolia
    defaultPrice: "0.001"
    facilitatorURL: http://mock-facilitator:8080
  routes:
    - path: "/api/v1/*"
      # inherits defaultPrice, all-pay mode
    - path: "/api/v2/**"
      price: "0.01"
      mode: conditional
      conditions:
        - header: "X-Bot-Score"
          pattern: "^(bot|automated)$"
          action: pay
        - header: "User-Agent"
          pattern: "(?i)(claude|openai|anthropic)"
          action: pay
    - path: "/health"
      free: true
    - path: "/docs/**"
      free: true
